@use '../../00-config/tokens/variables' as t;

// @component button
// @element button

// Token definitions - what makes each variant
@layer components.tokens {
  .button {
    // Single accent color - all shades derived via color-mix
    --_accent: var(--ui-button-accent, var(--ui-color-primary, #{t.$color-primary}));

    --_height: var(--ui-button-height, var(--ui-row-2, #{t.$row-2}));
    --_padding-x: var(--ui-button-padding-x, var(--ui-space-2, #{t.$space-2}));
    --_font-size: var(--ui-button-font-size, var(--ui-font-size-sm, #{t.$font-size-sm}));
    --_font-weight: var(--ui-button-font-weight, var(--ui-weight-medium, #{t.$weight-medium}));
    --_radius: var(--ui-button-radius, var(--ui-radius-md, #{t.$radius-md}));
    --_bg: var(--_accent);
    --_bg-hover: color-mix(in oklch, var(--_accent) 80%, black);
    --_text: var(--ui-button-text, var(--ui-color-text-inverse, #{t.$color-text-inverse}));
  }

  // @modifier size
  .button--sm {
    --_height: var(--ui-button-height-sm, calc(var(--row, #{t.$row}) * 1.5));
    --_font-size: var(--ui-button-font-size-sm, var(--ui-font-size-xs, #{t.$font-size-xs}));
  }

  .button--lg {
    --_height: var(--ui-button-height-lg, calc(var(--row, #{t.$row}) * 2.5));
    --_padding-x: var(--ui-button-padding-x-lg, var(--ui-space-3, #{t.$space-3}));
    --_font-size: var(--ui-button-font-size-lg, var(--ui-font-size-md, #{t.$font-size-md}));
  }

  // @modifier variant
  .button--secondary {
    --_bg: var(--ui-color-bg-muted, #{t.$color-bg-muted});
    --_bg-hover: var(--ui-color-border-strong, #{t.$color-border-strong});
    --_text: var(--ui-color-text, #{t.$color-text});
  }

  .button--ghost {
    --_bg: transparent;
    --_bg-hover: color-mix(in oklch, var(--_accent) 10%, transparent);
    --_text: var(--_accent);
  }

  .button--outline {
    --_bg: transparent;
    --_bg-hover: var(--_accent);
    --_text: var(--_accent);
    --_text-hover: var(--ui-color-text-inverse, #{t.$color-text-inverse});
    --_border: var(--ui-border-width-sm, #{t.$border-width-sm}) solid currentColor;
  }

  .button--danger {
    --_accent: var(--ui-color-danger, #{t.$color-danger});
  }

  .button--link {
    --_bg: transparent;
    --_bg-hover: transparent;
    --_text: var(--_accent);
    --_text-hover: color-mix(in oklch, var(--_accent) 70%, black);
    --_height: auto;
    --_padding-x: 0;
    --_radius: 0;
  }

  // @modifier boolean icon
  .button--icon {
    --_padding-x: 0;
  }

  // @modifier radius
  .button--radius-none {
    --_radius: 0;
  }

  .button--radius-sm {
    --_radius: var(--ui-radius-sm, #{t.$radius-sm});
  }

  .button--radius-lg {
    --_radius: var(--ui-radius-lg, #{t.$radius-lg});
  }

  .button--radius-full {
    --_radius: 624.9375rem; // large value for pill shape
  }

  // @modifier boolean block
  // @modifier boolean loading
}

// Implementation - structural styles
@layer components.styles {
  .button {
    // Layout
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--ui-space-1, #{t.$space-1});

    // Size
    block-size: var(--_height);
    padding-inline: var(--_padding-x);

    // Visual
    margin: 0;

    // Typography
    font-family: var(--ui-font-sans, #{t.$font-sans});
    font-size: var(--_font-size);
    font-weight: var(--_font-weight);
    line-height: 1;
    text-decoration: none;
    white-space: nowrap;
    color: var(--_text);

    background: var(--_bg);
    border: var(--_border, none);
    border-radius: var(--_radius);
    cursor: pointer;

    // Transitions
    transition:
      background-color var(--ui-duration-base) var(--ui-ease-default),
      color var(--ui-duration-base) var(--ui-ease-default),
      transform var(--ui-duration-fast) var(--ui-ease-default);

    // States - modifiers mirror pseudo-classes for testing/docs
    &:hover,
    &--hover {
      color: var(--_text-hover, var(--_text));

      background: var(--_bg-hover);
    }

    &:focus-visible,
    &--focus {
      outline: var(--ui-border-width-md, #{t.$border-width-md}) solid var(--ui-color-focus, #{t.$color-focus});
      outline-offset: var(--ui-border-width-md, #{t.$border-width-md});
    }

    &:active,
    &--active {
      transform: scale(0.98);
    }

    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;

      &:hover {
        background: var(--_bg);
        transform: none;
      }
    }

    // Icon-only button
    &--icon {
      inline-size: var(--_height);
    }

    // Full width
    &--block {
      inline-size: 100%;
    }

    // Link variant underline
    &--link {
      text-decoration: underline;
      text-underline-offset: var(--ui-space-quarter);

      &:hover {
        text-decoration-thickness: var(--ui-space-quarter);
      }
    }

    // Icon elements
    &__icon {
      flex-shrink: 0;

      block-size: 1em;
      inline-size: 1em;

      &--start {
        order: -1;
      }

      &--end {
        order: 1;
      }
    }

    // Loading state
    &--loading {
      position: relative;

      opacity: 0.7;
      pointer-events: none;

      &::after {
        content: '';
        position: absolute;

        block-size: 1em;
        inline-size: 1em;

        border: 2px solid currentcolor;
        border-radius: 50%;

        animation: button-spin 0.6s linear infinite;
        border-inline-end-color: transparent;
      }
    }
  }

  @keyframes button-spin {
    to {
      transform: rotate(360deg);
    }
  }
}
