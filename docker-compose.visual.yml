services:
  visual-tests:
    image: mcr.microsoft.com/playwright:v1.57.0-noble
    platform: linux/amd64
    working_dir: /app
    volumes:
      - .:/app
      - /app/node_modules
      - /app/.pnpm-store
      - visual-test-cache:/root/.cache
      - visual-test-pnpm:/root/.local/share/pnpm
    environment:
      - CI=true
      - PNPM_HOME=/root/.local/share/pnpm
      - PATH=/root/.local/share/pnpm:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    command: >
      bash -c "
        npm install -g pnpm@9.15.0 &&
        pnpm install --frozen-lockfile &&
        pnpm nx build css &&
        echo 'Ready! Container will stay running.' &&
        tail -f /dev/null
      "

volumes:
  visual-test-cache:
  visual-test-pnpm:
